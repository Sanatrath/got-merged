<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=1024, initial-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>Game of Thrones</title>
<link rel="stylesheet" href="css/styles.css" type="text/css" />
<script src="http://localhost:11000/socket.io/socket.io.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script src="js/e-smart-zoom-jquery.min.js"></script>
<script src="js/owl.carousel.min.js"></script>
  <!-- Unless using the CDN hosted version, update the URL to the Flash SWF -->
<link rel="stylesheet" href="css/owl.carousel.css" type="text/css" />

<!--[if lt IE 9]>
			<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
<script>
			var lastX, lastY;
			var maxScene = 0;
			var owl;
			var flag = 0;
			$(document).ready(function() {
				$('#imageFullScreen').smartZoom({'maxScale':5,'containerClass':'zoomableContainer'});
			/*					
				$('#zoomInButton,#zoomOutButton').bind("click", zoomButtonClickHandler);

				function zoomButtonClickHandler(e){
			    	var scaleToAdd = 1.5;
					if(e.target.id == 'zoomOutButton')
						scaleToAdd = -scaleToAdd;
					$('#imageFullScreen').smartZoom('zoom', scaleToAdd);
				
			    }
				
				*/	
			});
			$(window).load(function(){			
				owl = $("#thumbnails");
 
				  owl.owlCarousel({
				      items : 3.2, 
				      itemsDesktop : false, 
				      itemsDesktopSmall : false,
				      itemsTablet: false, 
				      itemsMobile : false,
				      rewindNav : false,
				      responsive: false,
				      afterMove: function(){
							setTimeout(function(){
		                    var style = window.getComputedStyle($("#thumbnails .owl-wrapper").get(0));
							var matrix = new WebKitCSSMatrix(style.webkitTransform);
							var transformPosition = matrix.m41;
							var calculatedPosition = (maxScene)*320;
							if ( calculatedPosition == Math.abs(transformPosition)){
								$(".next").hide();
								$(".pause").show();
							} 
							else{
								$(".next").show();
								$(".pause").hide();
							}	                    	
                    	},300)
						}
					});				 
				  
				  $(".next").click(function(){
				    owl.trigger('owl.next');
				  })
				  $(".prev").click(function(){
				    owl.trigger('owl.prev');
				  })

			 // Interactions on the event carousel at the bottom

					$('#thumbnails .item').on("click",function(){
						console.log("clicked");
						$(".item").removeClass('clicked');
						$(this).addClass('clicked');
						console.log($('#thumbnails .item').index(this));
						 owl.trigger('owl.goTo',$('#thumbnails .item').index(this));
					});
					
					$(".circle").delay(300).show();

				$("#scene1").on ("mouseout", function(){

				  })
		});
		
        var socket = io.connect('http://localhost:11000');		
		socket.on('videoStart', function  (data) {
			$("#eventListing").append('<p>' + data.message + '</p>');
		});

		socket.on('incomingEvent', function  (event) {
			var eventType = event.eventInfo.type;
			console.log(eventType);
			if (eventType == "newScene"){
				handleNewScene(event.eventInfo);
				console.log( event);
			}
			else if (eventType == "moment"){
				handleMoment(event.eventInfo);
			}
			else if (eventType == "character"){
				handleCharacterEntry(event.eventInfo);

			}
		});
		
		function handleNewScene(eventInfo){
			
			console.log("Writing new scene info");

			console.log(eventInfo);	
			
			//The very first scene we zoom into the map
			if(eventInfo.event == '0' && flag == 0){
				
				lastX = eventInfo.data.locationX;

				lastY = eventInfo.data.locationY;				
                x="100px";
				y="400px";
				$('#imageFullScreen').smartZoom('zoom', 2, {'x':lastX,'y':lastY+130}, 300);
				lastY = eventInfo.data.locationY;
				
                x="100px";
				y="400px";
				$('#imageFullScreen').smartZoom('zoom', 2, {'x':lastX,'y':lastY+130}, 300);
				flag=1;
					
			} 

			else{

				$('#imageFullScreen').smartZoom("pan",(lastX - eventInfo.data.locationX),(lastY - eventInfo.data.locationY),2000);
				
				$(".circle.big").css ({top: (eventInfo.data.locationY) , left:(eventInfo.data.locationX)});
				console.log("big-circle");
				console.log(eventInfo.data.locationX);
				console.log(eventInfo.data.locationY);
				lastX = eventInfo.data.locationX;
				lastY = eventInfo.data.locationY;	
					

	       	 }
	       	
	       	getCharacters(eventInfo.data.characters);
			$(".item").removeClass('clicked');
			
			$("#scene"+eventInfo.data.scene).on("click", function(){
				socket.emit('changeScene', {index: eventInfo.data.scene});})
				.show().addClass('clicked');
			owl.trigger('owl.goTo',eventInfo.data.scene);
			if (eventInfo.data.scene > maxScene)
				maxScene= eventInfo.data.scene;
		}
		/*<div class="momentCard">
			<div class="momentImg">
				<img src=""/>
			</div>
			<div class="momentContent">
				<div class="momentTitle"></div>
				<div class="momentDescription"></div>
			</div>
		</div>*/
		function handleMoment(eventInfo){
			console.log("yeah. I am trying to show you a moment");
			console.log(eventInfo);
			$(".momentImg img").attr("src", "assets/moments/moment"+eventInfo.event+".jpg");
			$(".momentTitle").html(eventInfo.data.title);
			$(".momentDescription").html(eventInfo.data.shortDescription);
		    $("#moments").animate({top:'380px', opacity:1},300).delay(3500).animate({top:'750px', opacity:0},300);
			
		}
		function handleCharacterEntry(eventInfo){
			console.log("try");	
			getCharacters(eventInfo.data.characters);
			
		}
		
		/*
		function getCharacters(characterInfo){
			
			var fields, container, width, height;
			switch (characterInfo.length) {
				case 2:
					$("#big-circle").html('');
					$('#big-circle').append('<div class="circle one small"></div> <div class="circle two small"></div>');
					var family = characterInfo[0].family;
					var img_url = "assets/headshots/" + family + "/" + characterInfo[0].name + ".png";
					$('.circle.one').css({'background':'url("'+img_url+'") center', 'background-size':'cover'}).addClass(family);

					family = characterInfo[1].family;
					img_url = "assets/headshots/" + family + "/" + characterInfo[1].name + ".png";
					$('.circle.two').css({'background':'url("'+img_url+'") center', 'background-size':'cover'}).addClass(family);

					var radius = 25;
					fields = $('.circle.small'); 
					container = $('#big-circle'); 
					width = container.width(); 
					height = container.height();

					var angle = 0, step = (2*Math.PI) / characterInfo.length;
					fields.each(function() {
					    var x = Math.round(width/2 + radius * Math.cos(angle) - $(this).width()/2);
					    var y = Math.round(height/2 + radius * Math.sin(angle) - $(this).height()/2);
					    if(window.console) {
					        console.log($(this).text(), x, y);
					    }
					    $(this).css({
					        left: x + 'px',
					        top: y + 'px'
					    });
					    angle += step;
					});	
					break;
				case 3: 
					console.log("3 people big circle");

					$("#big-circle").html('');	
					$("#big-circle").append('<div class="circle one small"></div><div class="circle two small"></div><div class="circle three small"></div>');

					var family = characterInfo[0].family;
					var img_url = "assets/headshots/" + family + "/" + characterInfo[0].name + ".png";
					$('.circle.one').css({'background':'url("'+img_url+'") center', 'background-size':'cover'}).addClass(family);

					family = characterInfo[1].family;
					img_url = "assets/headshots/" + family + "/" + characterInfo[1].name + ".png";
					$('.circle.two').css({'background':'url("'+img_url+'") center', 'background-size':'cover'}).addClass(family);

					family = characterInfo[2].family;
					img_url = "assets/headshots/" + family + "/" + characterInfo[2].name + ".png";
					$('.circle.three').css({'background':'url("'+img_url+'") center', 'background-size':'cover'}).addClass(family);	

					var radius = 25;
					fields = $('.circle.small'); 
					container = $('#big-circle'); 
					width = container.width(); 
					height = container.height();
					var angle = 0, step = (2*Math.PI) / 3;
					fields.each(function() {
					    var x = Math.round(width/2 + radius * Math.cos(angle) - $(this).width()/2);
					    var y = Math.round(height/2 + radius * Math.sin(angle) - $(this).height()/2);
					    if(window.console) {
					        console.log($(this).text(), x, y);
					    }
					    $(this).css({
					        left: x + 'px',
					        top: y + 'px'
					    });
					    angle += step;
					});
					break;
			}
		} */

		function getCharacters(characterInfo){
				var family, img_url;
				$("#big-circle").html('');
				var circleNum = characterInfo.length;
			    var radius = 25,
			        smallRadius = 7.5;
			    var container = $('#big-circle'), 
			        width = container.width(), 
			        height = container.height();
			    var angle = 0, step = (2*Math.PI) / circleNum;
			    for (var i = circleNum - 1; i >= 0; i--) {
			        var x = Math.round(width/2 + radius * Math.cos(angle) - smallRadius);
			        var y = Math.round(height/2 + radius * Math.sin(angle) - smallRadius);

			        family = characterInfo[i].family;
			        name = characterInfo[i].name;
					img_url = "assets/headshots/" + family + "/" + name + ".png";
			        var circleCont = '<div class="circle small"></div>';
			        var tagCont = '<div class="nametag">' + name + '</div>';
			        newTag = $(tagCont);
			        newCircle = $(circleCont);
			        newCircle.css({'background':'url("'+img_url+'") center', 'background-size':'cover'}).addClass(family);	
			        newCircle.appendTo($("#big-circle")).append(newTag);
			        newCircle.css({
			            left: x + 'px',
			            top: y + 'px'
			        });
			        if ( y>width/2 ) {
			        	newTag.css({		            
				           top: '16px'
				        });
			        }else{
			        	newTag.css({		                
				            bottom: '6px'
				        });
			        }
			        console.log("Here is angle")
			        console.log(angle);
			        angle += step;

			       
			    
			    }
		}



		</script>
</head>
<body>
<div id="app">
	<div class="name"><h1>Scene Name</h1></div>
	<div id="pageContent">
		<div id="imgContainer"> 
			 
<div id="imageFullScreen">
			 	
			 	<div id="big-circle" class="circle big">
				 		
			    </div>
			    <img class="mapper" src="assets/map.jpg" alt="map"/>
			 </div>

			 <!-- <img id="imageFullScreen" src="assets/map.jpg" alt="map"/> -->
			 	
			 </div>
		</div>
		
		
	<div id="moments">
		<div class="momentCard">
			<div class="momentImg">
				<img src=""/>
			</div>
			<div class="momentContent">
				<div class="momentTitle"></div>
				<div class="momentDescription"></div>
			</div>
		</div>
	</div>
	</div>
<!--
	<div id="positionButtonDiv">
		<img id="zoomInButton" class="zoomButton" src="assets/zoomin.png" title="zoom in" alt="zoom in" /> 
		<img id="zoomOutButton" class="zoomButton" src="assets/zoomout.png" title="zoom out" alt="zoom out" />
	</div>
-->	
	<div id="scenes">
	<div id="thumbnails" class="owl-carousel owl-theme">
	  <div>&nbsp;</div>
	  <div>&nbsp;</div>
		<div id="scene0" class="item orange">
			<img src="assets/timeline/scene0.jpg"/>
		</div>
		<div id="scene1" class="item orange">
			<img src="assets/timeline/scene1.jpg"/>
		</div>
		<div id="scene2" class="item orange">
			<img src="assets/timeline/scene2.jpg"/>
		</div>
		<div id="scene3" class="item orange">
			<img src="assets/timeline/scene3.jpg"/>
		</div>
		<div id="scene4" class="item orange">
			<img src="assets/timeline/scene4.jpg"/>
		</div>
	</div>
	 	
	  <a class="move-left btn prev">
		  <img src="assets/slider-left.png" />
	  </a>
	  <a class="move-right btn next"> 
		  <img src="assets/slider-right.png" />
		  
		  
	  </a>
	  <a class="move-right pause btn"> 
		  <img src="assets/pause.png" />
	  </a>
	  
	</div>
	

</div>
</body>
</html>
